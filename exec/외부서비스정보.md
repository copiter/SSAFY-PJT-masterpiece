# Amazon S3(Simple Storage Service)
- AWS에서 제공하는 객체 스토리지 서비스
- 프로필 이미지, NFT 원본 파일을 업로드 및 관리하기 위해 사용

<br/>

## S3 버킷 접근 권한을 가진 AWS IAM 사용자 생성
AWS의 IAM 페이지에 접근하여 액세스 관리 > 사용자 > 사용자 추가 버튼을 누릅니다.  
![사용자_추가](/uploads/16d308ab1d06069830847703b97aa497/사용자_추가.PNG)
<br/>

그 후, 엑세스 키 방식을 선택하고 기존 정책 직접 연결 > AmazonS3FullAccess 를 체크하여 사용자를 추가합니다.  
![액세스_키_방식_선택](/uploads/e271a202f2ea1512e2dacf0c19db9b08/액세스_키_방식_선택.PNG)
![권한_설정](/uploads/f5367334e6231d205ddc4865e5b29a76/권한_설정.PNG)

<br/>

## AWS S3 bucket 생성
Amazon S3에 접근하여 버킷 만들기를 클릭, **퍼블릭 액세스가 가능하도록 버킷을 생성**합니다.  
그 중에서, **새 ACL(액세스 제어 목록)을 통해 부여된 버킷 및 객체에 대한 퍼블릭 액세스 차단**에 대한 허용이 필수입니다.  
![퍼블릭_액세스_차단_설정](/uploads/4bce4bbcfbb458c970c20548cd8e93ae/퍼블릭_액세스_차단_설정.PNG)
<br/>

버킷 만들기 버튼 클릭  
![버킷_만들기](/uploads/3aa71b57100041419c3d05d3c23458fe/버킷_만들기.PNG)
![버킷_만들기2](/uploads/2211f5158a0a5104e060b51c030159f3/버킷_만들기2.PNG)
<br/>

생성된 버킷에 접근하여 권한을 클릭 -> 버킷 정책의 편집 버튼 클릭  
정책 생성기 클릭하여 정책 생성  
![정책_생성기](/uploads/8cade6ed4f8b2512205fb29d5753c055/정책_생성기.PNG)
![정책_생성기2](/uploads/91aa541842ac0d12c8bd0f46d9f501a5/정책_생성기2.PNG)
<br/>

아래와 같은 형태의 json 파일 생성, 변경 사항 저장 버튼 클릭
```json
{
    "Version": "2012-10-17",
    "Id": "Policy1663652945650",
    "Statement": [
        {
            "Sid": "Stmt1663652943856",
            "Effect": "Allow",
            "Principal": "*",
            "Action": [
                "s3:DeleteObject",
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::masterpiecebucket/*"
        }
    ]
}
```

객체 소유권 변경
![객체_소유권_편집](/uploads/4cdcca0814196e8ee66e3d755c48b04e/객체_소유권_편집.PNG)

<br/><br/>

## build.gradle에 의존성 추가
```gradle
implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'
```

<br/>

## S3 config 파일 추가
```java
@Configuration
public class AWSConfig {
    @Value("${cloud.aws.credentials.access-key}")
    private String accessKey;
    @Value("${cloud.aws.credentials.secret-key}")
    private String secretKey;
    @Value("${cloud.aws.region.static}")
    private String region; // Bucket Region

    @Bean
    public AmazonS3Client amazonS3Client() {
        BasicAWSCredentials basicAWSCredentials = new BasicAWSCredentials(accessKey, secretKey);
        return (AmazonS3Client) AmazonS3ClientBuilder.standard()
                .withRegion(region)
                .withCredentials(new AWSStaticCredentialsProvider(basicAWSCredentials))
                .build();
    }
}
```

<br/><br/>

# Pinata
- IPFS pinning 서비스
- IPFS에 업로드한 파일을 쉽게 관리하기 위해 사용

1. https://www.pinata.cloud/ 에 접속한다.
2. 무료 계정으로 회원가입을 진행한다.
3. 프로필 사진 -> API KEYS로 접근하여 새로운 키를 발급받는다.
4. Admin을 설정하여 Create Key 버튼을 누른다.
![피나타](/uploads/d7b1cf6a9a1b259e5d044373975eea08/피나타.PNG)
5. 이후에 보여지는 API Key와 Secret Key를 저장해놓고 REST API 호출시에 사용한다.
